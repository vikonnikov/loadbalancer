# Балансировка нагрузки

## Задача

Развернуть web-кластер из двух docker-машин с помощью одного bash-скрипта

Среда контейнеризации:
Docker 17.x
Операционная система docker-машины: Ubuntu 16.04
Балансировщик: HAProxy -any
Веб-сервер: Nginx - any

Написать bash-скрипт, который в существующей среде контейнеризации Docker создаст и запустит два
docker-образа операционной системы Ubuntu, установит в каждый из образов балансировщик HAProxy и веб-сервер Nginx,
настроит балансировщики таким образом, чтобы трафик шел на один из доступных веб-серверов Nginx.
Bash-скрипт после запуска docker-образов операционной системы Ubuntu, должен проверить доступность
веб-серверов Nginx, используя порты балансировщиков HAProxy.

## Решение

Запуск более чем 1 процесса в контейнере, а также установка дополнительных приложений в контейнер вместо использования
существующих Docker-образов противоречат концепции конейнеризации Docker:

- https://docs.docker.com/develop/develop-images/dockerfile_best-practices
- https://devops.stackexchange.com/a/451

В связи с этим контейнеры с HAPROXY и NGINX разделены в рамках docker-compose.yml

## Запуск

Вызов скрипта `./balancer.sh` без опций запускает балансировщик и веб-серверы.

Вызов скрипта с опцией `./balancer.sh --status` выведет текущий статус серверов,
если контейнер с одним из серверов будет остановлен, то мы увидим следующий вывод данной команды:

```
Is DOWN first_server:172.20.0.3
Is RUNNING second_server:172.20.0.2
```

Скрипту может понадобиться пароль SUDO для чтения состояния балансировщика из сокета.

## Затраченное время

- Написание конфига для docker-compose ~ 20м
- Настройка HAProxy ~ 20м
- Написание bash-скрипта и отладка ~ 50м

**Итого: ~1ч30м**
